{{#let (changeset @episode this.EpisodeValidations) as |changeset|}}
  <Ui::ChangesetForm
    @containerClass="page-spacing"
    @changeset={{changeset}}
    @onError={{this.onError}}
    @onSubmit={{this.onSubmit}}
    data-test-episode-form
    as |Form|
  >
    <section class="my-2">

      {{! header and time stamp}}
      <div class="flex justify-start italic text-sm my-1">
        <span>{{t "profile.my-shows.form.air-date"}}</span>
        <span>
          {{format-day @episode.start}}
          -
          {{format-time @episode.start}}
        </span>
      </div>

      {{! title, description, and tag input }}
      <div>
        <Form.Input
          @label={{t "profile.my-shows.form.title"}}
          @fieldName="title"
          @containerClass="mb-2 flex justify-start gap-4"
        />
        <Form.Textarea
          @label={{t "profile.my-shows.form.description"}}
          @fieldName="description"
          @containerClass="mb-2 flex justify-start gap-4"
          @size="lg"
          @value={{changeset.description}}
          rows="5"
          cols="35"
        />
        <LabelsSelect
          class="my-2 flex justify-start gap-4"
          @changeset={{changeset}}
        />
      </div>

      {{! episode artwork uploader }}
      <div class="flex justify-start gap-10 mb-4 relative">
        <label class="align-top" for="show-artwork">
          {{t "profile.my-shows.form.artwork"}}
        </label>

        {{#let (episode-image-url changeset) as |imageUrl|}}
          {{#if imageUrl}}
            <div class="relative">
              <img
                alt="your show's artwork for this episode"
                width="300"
                height="300"
                src={{imageUrl}}
              />
              <div
                class="absolute size-24 bottom-0 left-0 flex items-center gap-2"
              >
                <label for="showArtwork">
                  <input
                    class="text-df-yellow semibold border-dashed"
                    id="showArtwork"
                    name="showArtwork"
                    type="file"
                    accept="image/*"
                    {{on "change" this.updateFile}}
                  />
                </label>
                <button
                  type="button"
                  class="cool-button"
                  name="change"
                  title="Remove artwork"
                  {{on "click" (fn this.deleteFile changeset)}}
                >
                  X
                </button>
              </div>
            </div>
          {{else}}
            {{! No image, show a simple file input }}
            <input
              class="text-df-yellow semibold border-dashed"
              id="showArtwork"
              name="showArtwork"
              type="file"
              accept="image/*"
              {{on "change" this.updateFile}}
            />
          {{/if}}
        {{/let}}
      </div>

      {{! check if this is an archive  }}
      {{#if @episode.airDatePassed}}
        <div>
          <div class="my-2 flex justify-start gap-4">
            <label for="archive-status">
              {{t "profile.my-shows.form.archive-status"}}
            </label>
            <select
              id="archive-status"
              name="archive-status"
              {{on "change" (pick "target.value" (set changeset "status"))}}
            >
              {{#each-in this.statusOptions as |key val|}}
                <option value="{{val}}" selected={{eq changeset.status val}}>
                  {{key}}
                </option>
              {{/each-in}}
            </select>
          </div>
          <MyShows::RecordingSelector @changeset={{changeset}} />
          <div class="my-2 py-2">
            <Form.Input
              @label={{t "profile.my-shows.form.youtube-link"}}
              @fieldName="youtubeLink"
              @containerClass="mb-2"
            />
            <Form.Input
              @label={{t "profile.my-shows.form.mixcloud-link"}}
              @fieldName="mixcloudLink"
              @containerClass="mb-2"
            />
            <Form.Input
              @label={{t "profile.my-shows.form.soundcloud-link"}}
              @fieldName="soundcloudLink"
              @containerClass="mb-2"
            />
          </div>
        </div>
      {{else}}
        {{! airdate has *not* passed; its an upcoming show }}
        <div>
          <div class="flex justify-start gap-4 my-4">
            <label>{{t "profile.my-shows.form.time-len"}}</label>
            <TimePicker
              @label="Start time"
              @property="start"
              @changeset={{changeset}}
              @onChange={{this.setEndAfterStart}}
            />
            <TimePicker
              @label="Duration"
              @property="end"
              @changeset={{changeset}}
              @startTime={{changeset.start}}
            />
          </div>
        </div>
        <div class="flex justify-start gap-10 mb-4 relative">
          <label>{{t "profile.my-shows.form.upload-new"}}</label>
          <div class="flex justify-end gap-2">
            <TrackUploader
              @changeset={{changeset}}
              @onStartUpload={{this.onStartUpload}}
              @onFinishUpload={{this.onFinishUpload}}
            />
          </div>
        </div>
        {{#if changeset.prerecordTrackId}}
          <div class="font-bold">
            {{changeset.prerecordTrackFilename}}
          </div>
        {{/if}}
      {{/if}}
    </section>

    <div class="mb-4">
      <Button
        @type="submit"
        @intent="primary"
        disabled={{(or
          (eq this.isUploading true)
          (or Form.state.hasSubmitted changeset.isInvalid)
        )}}
        class="cool-button mb-2"
        data-test-submit-button
      >
        {{t "profile.my-shows.form.update"}}
      </Button>
    </div>
    {{#if
      (or
        (eq this.currentUser.user.username @episode.hostedBy)
        (includes "admin" this.currentUser.user.roles)
      )
    }}
      <div>
        <Button
          @type="submit"
          @intent="danger"
          class="cool-button mb-2 danger"
          data-test-delete-button
          {{on "click" this.deleteEpisode}}
        >
          {{t "profile.my-shows.form.delete"}}
        </Button>
      </div>
    {{/if}}
  </Ui::ChangesetForm>
{{/let}}